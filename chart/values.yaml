# Gradle Build Cache Configuration

# Enable/disable the entire cache deployment
enabled: true

# Docker image
image:
  repository: ghcr.io/ls1intum/theia-shared-cache/gradle-cache
  tag: "main"
  pullPolicy: IfNotPresent

# Authentication credentials
auth:
  enabled: true
  username: "gradle"
  # IMPORTANT: Change this password in production!
  password: "changeme"

# Storage configuration
storage:
  # Persistent volume size for cache data
  size: 50Gi
  # Storage class for persistent volume
  storageClass: "csi-rbd-sc"

# Resource limits
resources:
  cacheServer:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "500m"

  minio:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

tls:
  # Enable TLS for the cache server
  enabled: false
  # TLS secret name (if TLS is enabled)
  secretName: ""

# Reposilite - Maven/Gradle dependency proxy
reposilite:
  enabled: true

  # Persistence for cached artifacts (stored on Ceph)
  persistence:
    enabled: true
    size: 20Gi
    storageClass: "csi-rbd-sc"

  # Resource limits (Reposilite is lightweight - ~20-30MB RAM)
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "500m"

  # JVM and Reposilite startup settings
  env:
    - name: JAVA_OPTS
      value: "-Xmx128M"
    - name: REPOSILITE_OPTS
      value: "--token admin:changeme --shared-configuration=/app/data/configuration.shared.json"

  # Mount shared configuration into Reposilite pod
  deployment:
    additionalVolumes:
      - name: shared-config
        configMap:
          name: reposilite-shared-config
    additionalVolumeMounts:
      - name: shared-config
        mountPath: /app/data/configuration.shared.json
        subPath: configuration.shared.json