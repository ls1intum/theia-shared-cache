{{- if .Values.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-config
  labels:
    {{- include "theia-shared-cache.labels" . | nindent 4 }}
    app.kubernetes.io/component: cache-server
data:
  config.yaml: |
    server:
      port: 8080
      read_timeout: 30s
      write_timeout: 120s
      {{- if .Values.tls.enabled }}
      tls:
        enabled: true
        cert_file: /etc/certs/tls.crt
        key_file: /etc/certs/tls.key
      {{- end}}

    storage:
      addr: "{{ .Release.Name }}-redis:6379"
      db: {{ .Values.storage.db }}

    cache:
      max_entry_size_mb: 100

    auth:
      enabled: {{ .Values.auth.enabled }}
      {{- if .Values.auth.enabled }}
      users:
        - username: {{ .Values.auth.username | quote }}
      {{- end }}

    logging:
      level: "info"
      format: "json"
{{- end }}
