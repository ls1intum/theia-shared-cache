{{- if .Values.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-config
  labels:
    app: {{ .Release.Name }}
    component: cache-server
data:
  config.yaml: |
    server:
      port: 8080
      read_timeout: 30s
      write_timeout: 120s
      {{- if .Values.tls.enabled }}
      tls:
        enabled: true 
        cert_file: /tls/tls.crt
        key_file: /tls/tls.key
      {{- end}}

    storage:
      endpoint: "{{ .Release.Name }}-minio:9000"
      bucket: "gradle-cache"
      use_ssl: false

    cache:
      max_entry_size_mb: 100

    auth:
      enabled: {{ .Values.auth.enabled }}
      {{- if .Values.auth.enabled }}
      users:
        - username: {{ .Values.auth.username | quote }}
      {{- end }}

    logging:
      level: "info"
      format: "json"
{{- end }}
